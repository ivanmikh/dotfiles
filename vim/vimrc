" All system-wide defaults are set in $VIMRUNTIME/debian.vim and sourced by
" the call to :runtime you can find below.  If you wish to change any of those
" settings, you should do it in this file (/etc/vim/vimrc), since debian.vim
" will be overwritten everytime an upgrade of the vim packages is performed.
" It is recommended to make changes after sourcing debian.vim since it alters
" the value of the 'compatible' option.

" This line should not be removed as it ensures that various options are
" properly set to work with the Vim-related packages available in Debian.
runtime! debian.vim

runtime! ftplugin/man.vim
" No Vi compatibility
set nocompatible

let mapleader = ";"
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vim-plug
" - For Neovim: stdpath('data') . '/plugged'
" - Avoid using standard Vim directory names like 'plugin'
call plug#begin('~/.vim/plugged')

" Plugins
Plug 'Konfekt/FastFold'
Plug 'sheerun/vim-polyglot'
Plug 'tpope/vim-commentary'
Plug 'scrooloose/nerdtree'
Plug 'Valloric/YouCompleteMe'
Plug 'francoiscabrol/ranger.vim'
Plug 'vim-scripts/taglist.vim'
Plug 'ericcurtin/CurtineIncSw.vim'
Plug '/usr/share/gocode/src/github.com/junegunn/fzf'
"Plugin 'octol/vim-cpp-enhanced-highlight'
"Plugin 'justinmk/vim-syntax-extra'
"Plugin 'jiangmiao/auto-pairs'
"Plugin 'davidhalter/jedi-vim'
"Plugin 'fholgado/minibufexpl.vim'
"Plugin 'vim-airline/vim-airline'
"Plugin 'vim-airline/vim-airline-themes'
"Plugin 'bling/vim-bufferline'

" Initialize plugin system
call plug#end()

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Terminal

" 256-color terminal
set t_Co=256

" Fast terminal connection
set ttyfast

" If using a dark background within the editing area and syntax highlighting
" turn on this option as well
set background=dark
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Movement

" Move vertically by visual line
nnoremap j gj
nnoremap k gk
nnoremap <down> gj
nnoremap <up> gk

" Move to beginning/end of line
nmap <Home> ^
nmap <End> $

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Clipboard 

" Use system clipboard
" set clipboard=unnamed

" Leave contents of system clipboard on exit
autocmd VimLeave * call system("xclip -sel clip", getreg('+'))

" copy selection to system clipboard
vnoremap +p "+p
vnoremap +y "+y
vnoremap +d "+d

" paste from system clipboard
nnoremap +p "+p
nnoremap +y "+y
nnoremap +d "+d

" Copy filepath to system clipboard
nmap <Leader>cp :let @+ = expand("%:p:a")<CR>

" Paste/delete without yanking selected
vnoremap p "_dP
nnoremap x "_x
vnoremap x "_x

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Keys and spaces

" Fix backspace
set bs=indent,eol,start

" Wrap on pressing bs, space or arrows
set whichwrap=<,>,[,]

" Number of lines to show around the cursor
set scrolloff=10
" Show tabs and trailing spaces
set list
set listchars=tab:‚Üí\ ,eol:¬¨,space:¬∑,trail:-,extends:‚ùØ,precedes:‚ùÆ
set showbreak=‚Ü™

" Tab control
set expandtab               " insert tabs rather than spaces for <Tab>
set smarttab                " tab respects 'tabstop', 'shiftwidth', and 'softtabstop'
set tabstop=4               " the visible width of tabs
set softtabstop=4           " edit as if the tabs are 4 characters wide
set shiftwidth=4            " number of spaces to use for indent and unindent
set shiftround              " round indent to a multiple of 'shiftwidth'
set completeopt+=longest

set cindent

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Theme and View

" Show partial command keys
set showcmd

" Set colorscheme
colorscheme wombat256

" Tab colors
hi TabLine ctermfg=grey
hi TabLineSel ctermfg=white

set termguicolors

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"" Search

"" Recursive search
"set path+=**

" Nice way to show search results
set wildmenu

" The following are commented out as they cause vim to behave a lot
" differently from regular Vi. They are highly recommended though.
set showmatch       " Show matching brackets.
set ignorecase      " Do case insensitive matching
set smartcase       " Do smart case matching
set incsearch       " Incremental search
set autowrite       " Automatically save before commands like :next and :make
set mouse=a         " Enable mouse usage (all modes)

set number
set relativenumber
" highlight LineNr term=bold cterm=NONE ctermfg=DarkGrey ctermbg=NONE gui=NONE guifg=DarkGrey guibg=NONE

" Search in selected text
vnoremap <Leader>/ <Esc>/\%V
" Search selected text
vnoremap <expr> <Leader>// y/<C-R>*

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" CScope

if has('cscope')
  set cscopetag
  set nocscopeverbose

  if has('quickfix')
     set cscopequickfix=s-,c-,d-,i-,t-,e-
  endif

  cnoreabbrev csa cs add
  cnoreabbrev csf cs find
  cnoreabbrev csk cs kill
  cnoreabbrev csr cs reset
  cnoreabbrev css cs show
  cnoreabbrev csh cs help

  source ~/.vim/autoload/cscope_maps.vim

  " if filereadable("cscope.out")
  "   cs add cscope.out
  " endif
endif

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Splits

" Alt tab windows
" map T <C-W>w
map H <C-W>h
map L <C-W>l
" Map shift+arrows to change windows
map [1;2A <C-W>k
map [1;2B <C-W>j
map [1;2C <C-W>l
map [1;2D <C-W>h

" Open new split panes to right and bottom
set splitbelow
set splitright

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Buffers

" Close buffer and keep split
set hidden
"nnoremap <c-c> :bp\|bd #<CR>
nnoremap <c-c> :bd<CR>
nnoremap <C-N> :bn<CR>
nnoremap <C-P> :bp<CR>
nnoremap gb :ls<CR>:b<space>
nnoremap gvb :ls<CR>:vert sb<space>
nnoremap gsb :ls<CR>:sb<space>

" MiniBufExplorer
"hi MBENormal               ctermfg=darkgrey guibg=fg
"hi MBEChanged              ctermfg=grey     guibg=fg
"hi MBEVisibleNormal        ctermfg=darkgrey guibg=fg
"hi MBEVisibleChanged       ctermfg=grey     guibg=fg
"hi MBEVisibleActiveNormal  ctermfg=cyan     guibg=fg
"hi MBEVisibleActiveChanged ctermfg=magenta  guibg=fg
"let g:miniBufExplMapWindowNavVim = 1 
"let g:miniBufExplMapWindowNavArrows = 1 
"let g:miniBufExplMapCTabSwitchBufs = 1 
"let g:miniBufExplModSelTarget = 1 
"
" Bufferline
" let g:bufferline_echo = 0
" let g:bufferline_rotate = 2
" let g:bufferline_fixed_index = -1 "always last
" let g:bufferline_show_bufnr = 0
" let g:airline_section_x = ''
" let g:airline_section_y = ''

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Opening a file

" Uncomment the following to have Vim jump to the last position when
" reopening a file
if has("autocmd") && (! &diff)
    au BufReadPost * if line("'\"") > 1 && line("'\"") <= line("$") | exe "normal! g'\"" | endif
endif

" Uncomment the following to have Vim load indentation rules and plugins
" according to the detected filetype.
if has("autocmd")
  filetype plugin indent on
endif

set autoread

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Nerd Tree

" Toggle NERDTree file browser
map <F2> :NERDTreeToggle <CR>
let NERDTreeMinimalUI  = 0
let NERDTreeQuitOnOpen = 0
" Close NERDTree if it is the only buffer left
autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTree") && b:NERDTree.isTabTree()) | q | endif

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" TagList

" Toggle Tags List
map <F3> :Tlist<CR>
let Tlist_Use_Right_Window = 1

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Folding

set foldmethod=manual
set foldnestmax=10
set nofoldenable
set foldlevelstart=10

" create fold for matching brace
nnoremap <Leader>f V%zf

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Status line
" au InsertEnter * hi StatusLine term=reverse ctermbg=5 gui=undercurl guisp=Magenta
" au InsertLeave * hi StatusLine term=reverse ctermfg=0 ctermbg=2 gui=bold,reverse
set laststatus=2           " enable status line always
set statusline=[%n]        " Buffer number
set statusline+=\          " Insert space
set statusline+=CF:%F      " Path to the file
set statusline+=\          " Insert space
set statusline+=%r         " Read only flag
set statusline+=%9*\       " Gap
set statusline+=%9*CWD:    " Print "CWD"
set statusline+=%9*%{getcwd()} " Current working directory
set statusline+=%9*%=      " Switch to the right side
set statusline+=\ \        " Gap
set statusline+=%9*%m      " Modified
set statusline+=\ \        " Insert space
set statusline+=%9*%P         " Percentage
set statusline+=\ \        " Gap
set statusline+=%l:%c      " Current line : column
set statusline+=/          " Separator
set statusline+=%L         " Total lines

" Airline
" let g:airline_theme='badcat'
" let g:airline#extensions#bufferline#enabled = 1
" let g:airline#extensions#bufferline#overwrite_variables = 1
" let g:airline#extensions#whitespace#enabled = 0

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Source files navigation

" Switch header/source
map <F4> :call CurtineIncSw()<CR>

" Switch declaration/definition
map <F5> viwy<F4>/<C-R>*<CR>

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Editing
" Save file
map <Esc><Esc> :w<CR>
" Insert closing brace
inoremap {<CR> {<CR>}<Esc>O
" Enclose word
nnoremap <Leader>( wbi(<esc>Ea)<esc>
nnoremap <Leader>{ wbi{<esc>Ea}<esc>
nnoremap <Leader>" wbi"<esc>Ea"<esc>
nnoremap <Leader>' wbi'<esc>Ea'<esc>
nnoremap <Leader><space> wbi<space><esc>ea<space><esc>
" Remove Enclosing
nnoremap <Leader>re wbhxelx
" Space in normal mode
map <space> i<space><esc>l

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" YouCompleteMe

let g:ycm_always_populate_location_list = 1
let g:ycm_global_ycm_extra_conf='/home/ivan/Documents/dotfiles/vim/ycm_extra_conf.py'
let g:ycm_warning_symbol = '..'
let g:ycm_error_symbol = '>>'

highlight clear YcmWarningSign
highlight clear YcmWarningLine
highlight clear YcmWarningSection
highlight clear YcmErrorSign
highlight clear YcmErrorLine
highlight clear YcmErrorSection
highlight YcmWarningSign ctermfg=Cyan guifg=Cyan

let g:ycm_add_preview_to_completeopt=0
set completeopt-=preview

" Disable YCM for vimdiff
if &diff
  let g:loaded_youcompleteme = 1
endif

let g:clang_library_path='/usr/lib/x86_64-linux-gnu'
let g:ycm_server_python_interpreter='/usr/bin/python'

command GoToDec YcmCompleter GoToDeclaration
command GoToDef YcmCompleter GoToDefinition

command YcmLoad   let g:loaded_youcompleteme = 1
command YcmUnload let g:loaded_youcompleteme = 0

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Misc

" Block Ctrl-Z
nnoremap <c-z> :echo "Type quit to exit Vim"<CR>

" Directory for .swap files
set directory=~/.vim/swap/

" echo filepath
nnoremap <leader>cfp :let @+=expand("%:p")<CR>
nnoremap <leader>cfn :let @+=expand("%")<CR>

" Allow saving of files as sudo when I forgot to start vim using sudo.
command W w !sudo tee > /dev/null %

" Quit without saving
command Q q!

" Disable search highlight
nnoremap <leader>h :nohlsearch<CR>

" Run current file
nnoremap <leader>r :w<CR>:! ./% 

" Compile and run
command GccRun :!g++ % && ./a.out
